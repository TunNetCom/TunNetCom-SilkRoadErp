@using TunNetCom.SilkRoadErp.Sales.WebApp.Helpers
@using TunNetCom.SilkRoadErp.Sales.WebApp.PrintEngine.Reports.PaiementFournisseur.PrintTraite

@code {
    [Parameter] public PrintTraiteModel Model { get; set; } = null!;
}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lettre de Change</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Calibri', 'Arial', sans-serif;
            background: transparent;
            padding: 0;
            margin: 0;
            width: 210mm;
            height: 297mm;
        }
        
        .page {
            width: 210mm;
            height: 297mm;
            background: white;
            margin: 0;
            position: relative;
            padding: 0;
        }

        .element {
            position: absolute;
            font-size: 16px;
            font-family: 'Calibri', Arial, sans-serif;
            white-space: nowrap;
        }
        
        /* Positionnement ultra-précis basé sur ahla.pdf */
        
        /* Ligne 1 - Tunis Haut */
        .lieu-haut {
            left: 294.9pt;
            top: 35.9pt;
        }
        
        /* Ligne 2 - Dates */
        .dates-ligne {
            left: 208.9pt;
            top: 52.3pt;
            display: flex;
            gap: 46pt; /* 231.0 - 152.2 = 78.8pt total, mais c'est le début des mots */
        }
        
        /* Ligne 3 - Montant Haut Droite */
        .montant-droite {
            left: 429.5pt;
            top: 78.1pt;
        }
        
        /* Ligne 4 - RIB (Haut) */
        .rib-section {
            left: 172.0pt;
            top: 80.7pt;
            display: flex;
        }
        
        .rib-section .rib-etab { width: 30pt; text-align: center; margin-left: 10pt; }
        .rib-section .rib-agence { width: 35pt; text-align: center; margin-left: 5pt; }
        .rib-section .rib-compte { width: 120pt; text-align: center; }
        .rib-section .rib-cle { width: 25pt; text-align: center; }
        
        /* Ligne 5 - Bénéficiaire et Montant Milieu */
        .beneficiaire {
            left: 182.3pt;
            top: 127.1pt;
        }
        
        .montant-centre {
            left: 429.5pt;
            top: 122.1pt;
        }
        
        /* Ligne 6 - Montant en lettres */
        .montant-lettres {
            left: 63.8pt;
            top: 145.7pt;
        }
        
        /* Ligne 7 - Lieu et Dates Bas */
        .infos-bas {
            left: 95.0pt;
            top: 169.3pt;
            display: flex;
            gap: 20pt;
        }
        
        /* Ligne 8 - RIB Bas (Plus étroit) */
        .rib-bas {
            left: 38.8pt;
            top: 203.9pt;
            display: flex;
        }
        
        .rib-bas .rib-etab { width: 26pt; text-align: center; margin-left: 20pt; }
        .rib-bas .rib-agence { width: 30pt; text-align: center; margin-left: -3pt; }
        .rib-bas .rib-compte { width: 115pt; text-align: center; }
        .rib-bas .rib-cle { width: 22pt; text-align: center; margin-left: 10pt; }
        
        .adresse {
            left: 416.1pt;
            top: 208.9pt;
        }
        
        @@page {
            size: A4 portrait;
            margin: 0;
        }
        
        @@media print {
            html, body {
                width: 210mm;
                height: 297mm;
            }
            
            body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            .page {
                box-shadow: none !important;
                margin: 0 !important;
                page-break-after: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="page">
        <!-- Ligne 1: Lieu -->
        <div class="element lieu-haut">Tunis</div>
        
        <!-- Ligne 2: Dates -->
        <div class="element dates-ligne">
            <span>@(Model.DateEcheance?.ToString("dd/MM/yyyy") ?? "")</span>
            <span>@Model.DateCreation.ToString("dd/MM/yyyy")</span>
        </div>
        
        <!-- Ligne 3: RIB et Montant -->
        <div class="element rib-section">
            <span class="rib-etab">@Model.Tire.RibCodeEtab</span>
            <span class="rib-agence">@Model.Tire.RibCodeAgence</span>
            <span class="rib-compte">@Model.Tire.RibNumeroCompte</span>
            <span class="rib-cle">@Model.Tire.RibCle</span>
        </div>
        <div class="element montant-droite">@Model.Montant.ToString("F3", System.Globalization.CultureInfo.InvariantCulture)</div>
        
        <!-- Ligne 4: Bénéficiaire et Montant -->
        <div class="element beneficiaire">@Model.Tire.Nom</div>
        <div class="element montant-centre">@Model.Montant.ToString("F3", System.Globalization.CultureInfo.InvariantCulture)</div>
        
        <!-- Ligne 5: Montant en lettres -->
        <div class="element montant-lettres">@Model.MontantEnLettres</div>
        
        <!-- Ligne 6: Infos du bas -->
        <div class="element infos-bas">
            <span>Tunis</span>
            <span>@Model.DateCreation.ToString("dd/MM/yyyy")</span>
            <span>@(Model.DateEcheance?.ToString("dd/MM/yyyy") ?? "")</span>
        </div>
        
        <!-- Ligne 7: RIB et Adresse -->
        <div class="element rib-bas">
            <span class="rib-etab">@Model.Tire.RibCodeEtab</span>
            <span class="rib-agence">@Model.Tire.RibCodeAgence</span>
            <span class="rib-compte">@Model.Tire.RibNumeroCompte</span>
            <span class="rib-cle">@Model.Tire.RibCle</span>
        </div>
        <div class="element adresse">
            @if (Model.Banque != null)
            {
                <span>@Model.Banque.Nom</span>
                @if (!string.IsNullOrWhiteSpace(Model.Banque.Adresse))
                {
                    <span> - @Model.Banque.Adresse</span>
                }
            }
        </div>
    </div>
</body>
</html>
