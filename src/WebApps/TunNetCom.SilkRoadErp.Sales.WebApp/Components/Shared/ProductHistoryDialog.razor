@using TunNetCom.SilkRoadErp.Sales.WebApp.Components.Shared
@using TunNetCom.SilkRoadErp.Sales.WebApp.Helpers
@using Radzen
@using Radzen.Blazor
@inject DialogService DialogService

<div style="min-width: 970px; width: fit-content; max-width: 100%;">
    @if (Mode == HistoryMode.Vente)
    {
        <CurrentProductInfoCard />
    }

    @* Three tabs: Achats, Ventes (default), Prix du système *@
    <RadzenTabs @bind-SelectedIndex="selectedTabIndex">
        <Tabs>
            <RadzenTabsItem Text="Achats" Icon="shopping_cart">
                <PurchaseHistoryGrid ProductReference="@ProductReference" PageSize="7" />
            </RadzenTabsItem>
            <RadzenTabsItem Text="Ventes" Icon="sell">
                <SalesHistoryGrid ProductReference="@ProductReference" PageSize="7" />
            </RadzenTabsItem>
            <RadzenTabsItem Text="Prix du système" Icon="price_check">
                <ProductSystemPriceTab ProductReference="@ProductReference" />
            </RadzenTabsItem>
        </Tabs>
    </RadzenTabs>
</div>

<style>
    .rz-datatable thead th {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>

@if (ShowClose)
{
    <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
        <RadzenButton Text="Fermer" Click="@(() => DialogService.Close())" />
    </div>
}

@code {
    /// <summary>
    /// Default width when opening this dialog (single source of truth for all callers).
    /// </summary>
    public static string DefaultWidth { get; } = "1150px";

    /// <summary>
    /// Default height when opening this dialog (single source of truth for all callers).
    /// </summary>
    public static string DefaultHeight { get; } = "90%";

    /// <summary>
    /// The product reference to display history for.
    /// </summary>
    [Parameter] 
    public string ProductReference { get; set; } = string.Empty;
    
    /// <summary>
    /// The mode determines what content is shown:
    /// - Vente: Shows current product info card + Both tabs
    /// - Achat: Shows both tabs without current product card
    /// </summary>
    [Parameter] 
    public HistoryMode Mode { get; set; } = HistoryMode.Vente;
    
    /// <summary>
    /// Whether to show the close button.
    /// </summary>
    [Parameter] 
    public bool ShowClose { get; set; } = true;

    /// <summary>Selected tab index: 0=Achats, 1=Ventes (default), 2=Prix du système.</summary>
    private int selectedTabIndex = 1;
}
